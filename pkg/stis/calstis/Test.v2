# This libcvos.a is in this directory.  I copied it from
# /user/mdroe/stsdas/bin.redhat/ and deleted two objects:
herbert> ar -d libcvos.a xsynphot.o xtables.o

herbert> ar -tv libcvos.a
rw-r--r-- 1105/31  12552 Jan 14 11:23 2010 irafsppinit.o
rw-r--r-- 1105/31   9412 Jan 14 11:23 2010 irafmn.o
rw-r--r-- 1105/31   2896 Jan 14 11:23 2010 imspp.o
rw-r--r-- 1105/31   2928 Jan 14 11:23 2010 cvos_maideh.o
rw-r--r-- 1105/31   1332 Jan 14 11:23 2010 cvos_error.o
rw-r--r-- 1105/31  13276 Jan 25 10:45 2010 c_iraf_priv.o
rw-r--r-- 1105/31   7692 Feb  4 12:42 2010 irafinit.o
rw-r--r-- 1105/31   8780 Feb  4 12:42 2010 irafcmain.o
rw-r--r-- 1105/31   2244 Jan 14 11:13 2010 setpgrp_hack.o
rw-r--r-- 1105/31  32736 Feb  4 12:36 2010 xclio.o
rw-r--r-- 1105/31  57732 Feb  4 12:36 2010 xcurfit.o
rw-r--r-- 1105/31  25280 Feb  4 12:36 2010 xsurfit.o
rw-r--r-- 1105/31  52028 Feb  4 12:36 2010 xgsurfit.o
rw-r--r-- 1105/31  31508 Feb  4 12:36 2010 xnlfit.o
rw-r--r-- 1105/31  44172 Feb  4 12:36 2010 ximinterp.o
rw-r--r-- 1105/31   7344 Feb  4 12:36 2010 xgflib.o
rw-r--r-- 1105/31  81060 Feb  4 12:36 2010 ximio.o
rw-r--r-- 1105/31  45876 Feb  4 12:36 2010 xqpoe.o
rw-r--r-- 1105/31  16336 Feb  4 12:36 2010 xselector.o
rw-r--r-- 1105/31   5740 Feb  4 12:36 2010 xxtools.o
rw-r--r-- 1105/31  31816 Feb  4 12:36 2010 xmwcs.o
rw-r--r-- 1105/31 280640 Feb  4 12:36 2010 xvops.o

I removed irafinit.o from the following, and cerror.o no longer includes
the following (which are defined in c_iraf_priv.c):
    c_iraferr()
    c_iraferrmsg()
    clear_cvoserr()

	$link cs0.o ../calstis.a \
                ../../C/addCol.o \
                ../../C/cerror.o \      see above
                ../../C/c_imt.o \
                ../../C/ctables.o \
                ../../C/c_tbagt.o \
                ../../C/c_tbapt.o \
                ../../C/c_tbcdef1.o \
                ../../C/c_tbcfnd1.o \
                ../../C/c_tbciga.o \
                ../../C/c_tbcigi.o \
                ../../C/c_tbcigt.o \
                ../../C/c_tbcinf.o \
                ../../C/c_tbcnum.o \
                ../../C/c_tbegt.o \
                ../../C/c_tbept.o \
                ../../C/c_tbfpri.o \
                ../../C/c_tbfres.o \
                ../../C/c_tbhad.o \
                ../../C/c_tbhcal.o \
                ../../C/c_tbhgcm.o \
                ../../C/c_tbhgnp.o \
                ../../C/c_tbhgt.o \
                ../../C/c_tbhpcm.o \
                ../../C/c_tbhptt.o \
                ../../C/c_tbparse.o \
                ../../C/c_tbpsta.o \
                ../../C/c_tbrcsc.o \
                ../../C/c_tbrgtr.o \
                ../../C/c_tbrudf.o \
                ../../C/c_tbtacc.o \
                ../../C/c_tbtclo.o \
                ../../C/c_tbtcre.o \
                ../../C/c_tbtnam.o \
                ../../C/c_tbtopn.o \
                ../../C/initCol.o \
                ../../C/tbCopyTmpl.o \
                ../../C/tbHeader.o \
                ../../C/tbl_util.o \
                ../../C/tbSaveInfo.o \
                ../../C/c_phopar.o \
                /user/mdroe/stsdas/bin.redhat/libhstio.a \
                libcvos.a \
                ../../cfitsio/libcfitsio.a \
                -lstxtools -lapplib \
		-o cs0.e

herbert> mkpkg -p stsdas

ended with the following:

/user/mdroe/stsdas/bin.redhat/libhstio.a(hstio.o)(.text+0x165e): In function `openInputImage':
/wonkabar/data1/builds/stsdas/lib/hstio/hstioirf.c:178: undefined reference to `c_vfn2osfn'
/user/mdroe/stsdas/bin.redhat/libhstio.a(hstio.o)(.text+0x16a1):/wonkabar/data1/builds/stsdas/lib/hstio/hstioirf.c:198: undefined reference to `c_vfn2osfn'
/user/mdroe/stsdas/bin.redhat/libhstio.a(hstio.o)(.text+0x1a42): In function `openOutputImage':
/wonkabar/data1/builds/stsdas/lib/hstio/hstioirf.c:310: undefined reference to `c_vfn2osfn'
/user/mdroe/stsdas/bin.redhat/libhstio.a(hstio.o)(.text+0x1a6f):/wonkabar/data1/builds/stsdas/lib/hstio/hstioirf.c:313: undefined reference to `c_vfn2osfn'
/user/mdroe/stsdas/bin.redhat/libhstio.a(hstio.o)(.text+0x1d64): In function `openUpdateImage':
/wonkabar/data1/builds/stsdas/lib/hstio/hstioirf.c:411: undefined reference to `c_vfn2osfn'
collect2: ld returned 1 exit status

### Mar 5

So I extracted vfn2osfn from irafinit.c, compiled it (in ../C/) and moved
the object to here and included it in cs0/mkpkg, e.g.:

                ../../C/c_phopar.o \
                /user/mdroe/stsdas/bin.redhat/libhstio.a \
                ../vfn2osfn.o \
                libcvos.a \

And it linked.  I still get a segmentation violation in the call to
getSingleGroup in checkwav.c:

...
debug:  about to call CheckWav
debug:  about to call initHdr
debug:  initHdr called
debug:  about to call openInputImage
debug:  openInputImage called
debug:  about to call getHeader
debug:  getHeader called
debug:  about to call closeImage
debug:  closeImage called
debug:  about to call Get_KeyD
debug:  Get_KeyD called
debug:  Get_KeyI called
debug:  about to call freeHdr
debug:  freeHdr called
debug:  about to call initSingleGroup
debug:  about to call getSingleGroup
IRAF error: segmentation violation (501)
No user-posted exception handler!  Aborting...
