# vim: set syntax=python:
import os

def build_test(bld, name):
    return bld(
        features = ['cc', 'cprogram'],
        source = name,
        target = os.path.splitext(name)[0],
        includes = [
            bld.env.INCLUDEDIR, # the hstcal include directory
            '.',
            '../include'
            ],
        # The order of these libraries is important
        uselib_local = bld.env.LOCAL_LIBS,
        uselib = ['CFITSIO'],
        lib = bld.env.EXTERNAL_LIBS,
        libpath = bld.env.LIBPATH,
        install_path = '${PREFIX}/bin/test'
        )

def build(bld):
    for x in os.listdir(bld.path.abspath()):
        if x.startswith('test') and x.endswith('.c'):
            build_test(bld, x)
